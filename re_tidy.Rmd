---
title: "re_tidy"
output: html_document
date: "2023-03-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


First step: load the packages that are needed (tidyverse and dplyr), and then read the csv file (note: read_delim had to be used instead of read_csv because excel decided to make the csv with semicolons instead of commas for some obscure reason). 

```{r}
library(tidyverse)
library(dplyr)
Carbon <- readr::read_delim("./data/CarbonMeasurements.csv", delim = ";")
```

## step 2

To calculate the log-response ratio (RR) for each experiment, take the logarithm of the mean increased CO2 divided by the mean ambient CO2. This log-response ratio is then appended to the table so each measurement has their respective treatment effect number in the column  "log-response ratio". 

These log-response ratios are then aggregated and averaged (taking the mean) by experiment with the functions "group_by" and "summarise" in a separate dataframe "Carbon_agg". As a last step a table is created with "knitr::kable"

```{r}
Xambient <- Carbon[,"mean ambient CO2"]
Xincreased <- Carbon[,"mean increased CO2"]
RR <- log(Xincreased/Xambient)

RR <- RR%>% rename("log-response ratio" = "mean increased CO2")

Carbon <- Carbon %>% add_column(RR)

Carbon_agg <- Carbon |>
  group_by(Experiment) |>
  summarise(`log-response ratio` = mean(`log-response ratio`))

knitr::kable(Carbon_agg)

```

## step 3

The aggregation by time period accross all experiments of every log-response ratio is done by first adding a new column representing the three time periods with the function "mutate" using 4 cuts, inbetween which the three time intervals are situated. Basically, every row is being assigned one of these three intervals based on the time the experiment has been running (which is given in the column "time(years)"), and the summarizing will be done based on these intervals.  

Note that for the cut at 3 years, the number 2.9 has been used, as otherwise it would include experiments that have been running for 3 years in the category "early phase", whereas it should be in the category "mid-phase". "include.lowest = TRUE" is also added, as otherwise it would disregard all the measurements done at time = 0 in all experiments. 

After that, just like before, the log-response ratios are aggregated using their mean, this time based on the cuts that were added. As a last step, the table is created with the same function "knitr::kable"

```{r} 

Carbon_phases <-
  Carbon %>% mutate(phase = cut(`Time (years)`, c(0, 2.9, 6, Inf), labels = c("early phase", "mid-phase", "late phase"),   include.lowest = TRUE)) %>%
  group_by(phase) |>
  summarise(`log-response ratio` = mean(`log-response ratio`))

knitr::kable(Carbon_phases)

```